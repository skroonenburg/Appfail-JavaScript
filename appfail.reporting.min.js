window.appfail=window.appfail||{};appfail.reporting=(function(){var w=function(){function G(){return(((1+Math.random())*65536)|0).toString(16).substring(1)}return(G()+G()+"-"+G()+"-"+G()+"-"+G()+"-"+G()+G()+G())};var r={slug:null,processInterval:10,daysToStore:7,onBeforeStore:null,appfailApiRoot:"https://api.appfail.net"};var y={RequestUrl:"",HttpVerb:"",ReferrerUrl:document.referrer,OccurrenceTimeUtc:null,User:"Anonymous",PostValuePairs:[],QueryValuePairs:[],Cookies:[],UniqueId:null,UserAgent:navigator.userAgent,HttpStatus:null,Exceptions:[],PageCorrelationId:w(),IsXHRFailure:false,XHRRequestURL:null,ConnectionStatus:"online",IsStandalone:false,TimeOnPage:0};var o={ExceptionType:"Javascript Error",ExceptionMessage:"",StackTrace:""};var B={};var v=[];var i;var E=("ononline" in window&&"onoffline" in window)?true:false;var z=("JSON" in window)?true:false;var x=("localStorage" in window)?true:false;var t=new Date();var c=false;var q=null;var D=false;var u=c?false:(typeof navigator.onLine==="boolean")?true:false;var a=function(H){var I=!H?null:(H instanceof Array?[]:{});for(var G in H){if(typeof(H[G])==="object"){I[G]=a(H[G])}else{I[G]=H[G]}}return I};var l=function(K,J){var H={};for(var I in K){H[I]=K[I]}for(var G in J){H[G]=J[G]}return H};var f=function(G){if(D&&typeof console=="object"){console.log(G)}};var n=function(I,J,H){if(I.addEventListener){I.addEventListener(J.replace(/^on/,""),H,false)}else{if(I[J]){var G=I[J];I[J]=function(K){G(K);H(K)}}else{I[J]=function(K){H(K)}}}};(function(G){var H=G.prototype.send;G.prototype.send=function(M){var K=this;var I=M;var L;var J=function(){if(K.readyState===4){f(K);b({ReadyState:K.readyState,Status:K.status,StatusText:K.statusText})}if(L){L()}};if(this.addEventListener){this.addEventListener("readystatechange",J,false)}else{L=this.onreadystatechange;this.onreadystatechange=J}try{H.call(this,M)}catch(N){f(N);b({Code:N.code,Message:N.message,Name:N.name})}}})(XMLHttpRequest);var d=function(){n(window,"onerror",function(I,H,G){p(I,H,G);return true});i=window.setInterval(function(){if(v.length){h()}},B.processInterval*1000);if(E){n(window,"ononline",function(){e();h()})}};var F=function(){return(new Date()-t)};var m=function(G){G.RequestUrl=q?q:document.location.href;if(!G.OccurrenceTimeUtc){G.OccurrenceTimeUtc=new Date().getTime()}G.UniqueId=w();G.TimeOnPage=F();G.UserAgent=navigator.userAgent;G.Cookies=[];G.ReferrerUrl=document.referrer};var p=function(J,I,H){f(J,I,H);var G=a(y);G.OccurrenceTimeUtc=(J&&J.timeStamp)?new Date(J.timeStamp).getTime():null;var K=a(o);K.ExceptionMessage=J.message;K.StackTrace=J.filename+" --- line "+J.lineno;G.Exceptions.push(K);m(G);if(B.onBeforeStore){B.onBeforeStore(G)}v.push(G)};var b=function(H){f(H);var G=a(y);G.XHRRequestUrl="http://google.com/fakeurl";G.IsXHRFailure=true;G.HttpStatus=H.Status;m(G);if(B.onBeforeStore){B.onBeforeStore(G)}v.push(G)};var k=function(H){f(H);var G=a(y);var I=a(o);I.StackTrace=H.stack||"";if(H.type){I.ExceptionType=H.type}I.ExceptionMessage=H.message;G.Exceptions.push(I);m(G);if(B.onBeforeStore){B.onBeforeStore(G)}v.push(G)};var h=function(){if(v.length&&u&&!navigator.onLine){g("No connection found, stored reports to localStorage");j();v=[];return}var I={Slug:B.slug,ModuleVersion:"1.0.0.0",ApplicationType:"Javascript",FailOccurrences:[]};while(v.length){var H=v.shift();I.FailOccurrences.push(H)}v.length=0;var G=new Image();G.src=B.appfailApiRoot+"/JsFail/v1?json="+encodeURIComponent(JSON.stringify(I))};var j=function(){if(z){var J=window.localStorage.getItem("appfail-errors");if(J!==""&&J!==null){var H=JSON.parse(J);for(var I=0,G=H.length;I<G;I++){v.push(H[I])}}window.localStorage.setItem("appfail-errors",JSON.stringify(v))}};var e=function(){var L;var M=window.localStorage.getItem("appfail-errors");if(M===""||M===null){return}L=JSON.parse(M);var J=+new Date();var H=86400000;var N=B.daysToStore*H;var I=[];for(var K=0,G=L.length;K<G;K++){if(J-N>L[K].OccurrenceTimeUtc){g("Dropping an old error")}else{I.push(L[K])}}v=I;window.localStorage.removeItem("appfail-errors")};var s=function(){if(appfail.config){B=l(r,appfail.config);return}var K=document.getElementsByTagName("script");var G;for(var N=0,O=K.length;N<O;N++){if(K[N].src.indexOf("appfail.reporting.min.js")>-1){G=K[N];break}}if(G.src.indexOf("?")===-1){return}var H=G.src.split("?")[1];var I=H.split("&");var J={};for(var L=0,P=I.length;L<P;L++){var M=I[L].split("=");J[M[0]]=M[1]}B=l(r,J)};var A=(function(){s();if(!B.slug){g("No application slug was found.");return}if(u&&navigator.onLine){e()}d()})();var g=function(G){if(console&&console.error){console.error("appfail: "+G)}};var C=function(){f("hasOnlineBool: ",u);f("hasOfflineEvents: ",E);f("hasJSON: ",z);f("hasLocalStorage: ",x)};return{catchManual:k,processQueue:h,storeQueue:j,loadStoredErrors:e,runTests:C}})();